# Feature: Add GET /api/status endpoint returning server health information

## Feature Description
This feature adds a health check endpoint to the ADWS Test App backend that allows developers and monitoring systems to verify the server's operational status and dependencies without calling functional endpoints. The endpoint will return server health information including status, uptime, and MongoDB connection state, enabling quick diagnostics and automated health monitoring.

## Feature Capability
The feature adds the ability to:
- Query the server's health status via a dedicated REST endpoint
- Monitor MongoDB database connectivity status
- Track server uptime since startup
- Enable automated health monitoring and alerting systems
- Provide quick verification that the backend is operational

## Problem Statement
Currently, developers and monitoring systems must call functional endpoints (like `/api/hello` or `/api/messages`) to verify the backend is running. This approach doesn't provide clear health diagnostics, creates unnecessary load on functional endpoints, and doesn't expose dependency status (MongoDB connection state). A dedicated health check endpoint is needed to provide comprehensive health information for both development verification and production monitoring.

## Solution Statement
Implement a new GET `/api/status` endpoint that returns a JSON response containing:
1. `status`: A simple indicator of server health (e.g., "ok", "degraded")
2. `uptime`: Server uptime in seconds since startup
3. `mongodb`: Connection state ("connected" or "disconnected")
4. Optional fields for timestamp and version

The endpoint will integrate with the existing Express server and MongoDB connection tracking. The implementation will be minimal, non-blocking, and require no database queries, ensuring fast response times suitable for health checks and load balancers.

## Framework Integration
- **Express Integration**: Add a new GET route handler to the Express app in `server.js`
- **MongoDB Connection**: Leverage the existing `isMongoConnected()` function from `db/connection.js` to determine MongoDB connection status
- **No new dependencies**: Uses existing Express and Mongoose libraries already in `package.json`
- **Environment variables**: Optional PORT configuration already supported via dotenv
- **Startup tracking**: Add server startup timestamp tracking to calculate uptime
- **Testing**: Integrate with existing Jest + Supertest test framework

## Relevant Files
- **backend/server.js** — Main Express server file where the `/api/status` endpoint will be added; currently contains route definitions and server initialization
- **backend/db/connection.js** — Database connection module that manages MongoDB connectivity and provides `isMongoConnected()` function used to determine connection state
- **backend/tests/api.test.js** — Existing test file where unit tests for the `/api/status` endpoint will be added alongside existing endpoint tests
- **backend/package.json** — Project dependencies and scripts; no new dependencies required
- **README.md** — Project documentation where the new endpoint must be added to the API Endpoints table

### New Files
None required. All changes can be implemented in existing files.

## Implementation Plan
### Phase 1: Foundation
Prepare the server module for health check functionality by adding startup time tracking and preparing to export the server instance for testing.

### Phase 2: Core Implementation
Implement the `/api/status` endpoint with logic to determine MongoDB connection status and calculate server uptime.

### Phase 3: Integration
Add comprehensive tests and update documentation to complete the feature.

## Step by Step Tasks

### Step 1: Add server startup time tracking
- Import `{ isMongoConnected }` from `db/connection.js` in `server.js`
- Add a module-level constant to track server startup time: `const SERVER_START_TIME = Date.now();`
- This will be used to calculate uptime in the status endpoint

### Step 2: Create the /api/status endpoint handler
- Add a new GET route handler for `/api/status` after the existing `/api/hello` endpoint
- Calculate uptime as `Math.floor((Date.now() - SERVER_START_TIME) / 1000)` (in seconds)
- Call `isMongoConnected()` to determine MongoDB connection status
- Return JSON response with structure: `{ status, uptime, mongodb, timestamp }`
- Set appropriate HTTP status code (200 for healthy, 503 for degraded if MongoDB disconnected)

### Step 3: Write unit tests for the /api/status endpoint
- Open `backend/tests/api.test.js`
- Add test suite `describe('GET /api/status', () => { ... })`
- Test 1: Verify endpoint responds with 200 status code
- Test 2: Verify response contains required fields: `status`, `uptime`, `mongodb`, `timestamp`
- Test 3: Verify `status` field value is "ok"
- Test 4: Verify `mongodb` field value is either "connected" or "disconnected"
- Test 5: Verify `uptime` is a positive integer (number of seconds)
- Test 6: Verify `timestamp` is an ISO string

### Step 4: Update README.md API endpoints table
- Locate the "API Endpoints" section in README.md
- Add new row to the Backend API endpoints table:
  - Endpoint: `/api/status`
  - Method: `GET`
  - Response: `{"status": "ok", "uptime": <seconds>, "mongodb": "connected|disconnected", "timestamp": <iso-string>}`

### Step 5: Run all tests to validate implementation
- Execute the full test suite: `npm test`
- Verify all existing tests still pass (no regressions)
- Verify new `/api/status` tests pass

### Step 6: Manual verification of the endpoint
- Start backend: `cd backend && npm start`
- Test with curl: `curl http://localhost:3000/api/status`
- Verify JSON response contains all expected fields
- Verify `status` is "ok" when MongoDB is connected
- Verify response time is <100ms (suitable for health checks)

## Testing Strategy
### Unit Tests
- Test `/api/status` returns 200 status code and JSON content type
- Test response contains required fields: `status`, `uptime`, `mongodb`, `timestamp`
- Test `status` field equals "ok"
- Test `mongodb` field is either "connected" or "disconnected"
- Test `uptime` is a non-negative integer representing seconds
- Test `timestamp` is a valid ISO 8601 date string

### Integration Tests
- Test endpoint response time is acceptable (<100ms) for health check systems
- Verify existing endpoints (`/`, `/api/hello`, `/api/messages`) still function correctly
- Verify health endpoint provides MongoDB state reflecting actual connection status

### Edge Cases
- Test when MongoDB is disconnected (endpoint should return 200 with `mongodb: "disconnected"`)
- Test immediately after server startup (uptime should be 0 or very small)
- Test multiple rapid requests to verify endpoint consistency
- Test concurrent requests to verify thread-safe operation

## Acceptance Criteria
- GET `/api/status` endpoint exists and responds to requests
- Response returns HTTP 200 status code
- Response Content-Type is `application/json`
- Response includes `status` field with value "ok"
- Response includes `mongodb` field with value "connected" or "disconnected"
- Response includes `uptime` field with value as a positive integer (seconds)
- Response includes `timestamp` field with ISO 8601 formatted string
- MongoDB connection state in response accurately reflects actual connection status
- Unit tests created and passing for the new endpoint
- All existing tests continue to pass (zero regressions)
- README.md API endpoints table updated with new `/api/status` endpoint documentation
- Manual verification via `curl http://localhost:3000/api/status` returns expected JSON

## Validation Commands
Execute every command to validate the feature works correctly with zero regressions.

- `npm test` - Run all unit tests to validate feature implementation and ensure zero regressions
- `curl http://localhost:3000/api/status` - Manually verify endpoint returns valid JSON with expected structure (requires backend running on port 3000)
- `npm test -- --testNamePattern="GET /api/status"` - Run only the health status endpoint tests to isolate new feature validation
- `npm test -- --testNamePattern="GET"` - Run all GET endpoint tests to verify no regressions to existing endpoints

## Notes
- The health check endpoint is intentionally simple and non-blocking to ensure it responds quickly even under heavy server load
- No database queries are performed by this endpoint, making it suitable for frequent polling by monitoring systems
- The MongoDB connection status is determined via the existing `isMongoConnected()` function which checks both the `isConnected` flag and Mongoose's connection state
- The HTTP status code is 200 regardless of MongoDB connection state because the server itself is responding; this is standard practice for health checks (the `mongodb` field in the response indicates dependency status)
- Server uptime is calculated from a module-level timestamp that captures the moment Express app is instantiated, which occurs before MongoDB connection attempts
- Consider future enhancements: adding response time metrics, memory usage, or other system metrics to the status endpoint as monitoring needs evolve